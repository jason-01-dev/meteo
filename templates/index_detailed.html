<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>M√©t√©o D√©taill√©e et Alertes | Pro</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#6dd5fa">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/icon-180.png') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="M√©t√©o Pro">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/icon-32.png') }}">

</head>
<body>
    <div class="container">
        <h1>üå§ M√©t√©o & Alertes S√©curit√© Nationale</h1>

        <div id="alerts-section">
            
            {% if alerte_tsunami %}
            <div class="alert alert-warning" role="alert">
                <h3>üåä ALERTE TSUNAMI (Niveau: {{ alerte_tsunami.niveau }})</h3>
                <p><strong>Zones de risque:</strong> {{ alerte_tsunami.zones }}</p>
                <p><strong>Conseil:</strong> **{{ alerte_tsunami.conseil }}**</p>
                <p class="alert-link-row">
                    ‚Üí <a href="{{ alerte_tsunami.lien_details }}" target="_blank" rel="noopener noreferrer">Consulter le bulletin d'alerte</a>
                </p>
            </div>
            {% endif %}
            
            {% if alerte_seisme %}
            <div class="alert alert-danger" role="alert">
                <h3>üö® ALERTE S√âISME (Magnitude: {{ alerte_seisme.magnitude }})</h3>
                <p><strong>Localisation:</strong> {{ alerte_seisme.lieu }}</p>
                <p><strong>Heure de l'√©v√©nement:</strong> {{ alerte_seisme.heure }} UTC</p>
                <p class="alert-link-row">
                    ‚Üí <a href="{{ alerte_seisme.lien_details }}" target="_blank" rel="noopener noreferrer">Consulter les d√©tails officiels USGS</a>
                </p>
            </div>
            {% endif %}

            {% if alerte_meteo_severe %}
            <div class="alert alert-info" role="alert">
                <h3>‚ö†Ô∏è ALERTE M√âT√âO S√âV√àRE : {{ alerte_meteo_severe.type_alerte | upper }}</h3>
                <p><strong>Description:</strong> {{ alerte_meteo_severe.description }}</p>
                <p><strong>P√©riode:</strong> {{ alerte_meteo_severe.zones_temporelles }}</p>
                <p><strong>√âmetteur:</strong> {{ alerte_meteo_severe.niveau }}</p>
            </div>
            {% endif %}

            {% if not alerte_seisme and not alerte_tsunami and not alerte_meteo_severe %}
                <p class="no-alert">‚úÖ **Aucune alerte g√©ophysique ou m√©t√©o s√©v√®re majeure en cours.**</p>
            {% endif %}
        </div>

        <form method="POST">
            <input type="text" name="ville" placeholder="Entrez une ville (ex: Paris, Tokyo)" required>
            <button type="submit">Obtenir la m√©t√©o</button>
        </form>

        {% if meteo_actuelle %}
        <div class="result">

            <div class="meteo-block">
                <div class="meteo-info">
                    <h2>M√©t√©o actuelle pour {{ ville }}</h2>
                    <p class="meteo">{{ meteo_actuelle }}</p>
                    <ul>
                        {% for key, value in details.items() %}
                            <li><strong>{{ key }}:</strong> {{ value }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="city-photo">
                    <img src="{{ city_image_url }}" alt="Photo de {{ ville }}">
                </div>
            </div>

            <h2>Pr√©visions 3 jours</h2>
            <div class="previsions">
                {% for jour in prevision %}
                <div class="jour" onclick="toggleDetails({{ loop.index0 }})">
                    <h3>{{ jour.date }}</h3>
                    <p><strong>Condition:</strong> {{ jour.condition }}</p>
                    <p class="temp-summary">Max: {{ jour.max_temp }}¬∞C | Min: {{ jour.min_temp }}¬∞C</p>
                    <div class="jour-details" id="details-{{ loop.index0 }}" style="display:none;">
                        <hr>
                        <p><strong>Vent:</strong> {{ jour.vent }}</p>
                        <p><strong>Humidit√©:</strong> {{ jour.humidite }}</p>
                        <p><strong>UV:</strong> {{ jour.uv_index }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>

        </div>
        {% else %}
        <p class="placeholder-text">Entrez une ville pour voir la m√©t√©o d√©taill√©e et les pr√©visions √† 3 jours.</p>
        {% endif %}
        
        <hr>

        <div class="explications-elements">
            <h2>En savoir plus sur les √©l√©ments üî¨</h2>
            <p>Comprenez mieux les ph√©nom√®nes et sachez comment r√©agir :</p>
            <ul>
                <li><a href="#" onclick="showElementExplanation('seismes')">Les **S√©ismes** : Mesure, Origines et **S√©curit√©**</a></li>
                <li><a href="#" onclick="showElementExplanation('tsunami')">Les **Tsunamis** : Formation et Proc√©dures d'√âvacuation</a></li>
                <li><a href="#" onclick="showElementExplanation('meteo_severe')">La **M√©t√©o S√©v√®re** : Types d'Alertes et R√©action</a></li>
                <li><a href="#" onclick="showElementExplanation('uv_index')">L'**Indice UV** : Risque Solaire et Protection</a></li>
                <li><a href="#" onclick="showElementExplanation('vent')">Le Vent : Vitesse, √âchelle de Beaufort</a></li>
                <li><a href="#" onclick="showElementExplanation('humidite')">L'Humidit√© : Point de Ros√©e et Saturation</a></li>
            </ul>

            <div id="explanation-content" class="explanation-box">
                <p>S√©lectionnez un √©v√©nement ou un indice pour une explication d√©taill√©e et des conseils professionnels.</p>
            </div>
        </div>

    </div>

    <script>
    
    // Fonction d'affichage des d√©tails de pr√©vision
    function toggleDetails(index) {
        const details = document.getElementById('details-' + index);
        const parent = details.parentElement;
        if (details.style.display === "none" || details.style.display === "") {
            details.style.display = "block";
            parent.classList.add('active-day'); 
        } else {
            details.style.display = "none";
            parent.classList.remove('active-day');
        }
    }

    // Fonction d'affichage des explications d√©taill√©es et conseils
    function showElementExplanation(element) {
        const explanationBox = document.getElementById('explanation-content');
        let content = '';

        if (element === 'seismes') {
            content = `
                <h4>üö® S√©ismes : Mesure, Origines et S√©curit√©</h4>
                <p><strong>Explication:</strong> Un s√©isme est caus√© par la rupture soudaine des roches dans la cro√ªte terrestre, le long de failles. L'√©nergie lib√©r√©e se propage sous forme d'ondes. Il est mesur√© selon deux √©chelles : l'**√©chelle de magnitude** (Moment) qui quantifie l'√©nergie √† la source, et l'**√©chelle d'intensit√©** (Mercalli) qui √©value les effets et les dommages.</p>
                <p><strong>Conseils de S√©curit√©:</strong></p>
                <ul>
                    <li>**√Ä l'int√©rieur:** *DROP, COVER, HOLD ON*. Se baisser, se mettre √† l'abri sous un meuble solide (table/bureau), et s'y agripper jusqu'√† ce que les secousses cessent.</li>
                    <li>**√Ä l'ext√©rieur:** S'√©loigner des b√¢timents, des lignes √©lectriques et des arbres. Se mettre √† d√©couvert.</li>
                </ul>
            `;
        } else if (element === 'tsunami') {
            content = `
                <h4>üåä Tsunamis : Formation et Proc√©dures d'√âvacuation</h4>
                <p><strong>Explication:</strong> Un tsunami est une s√©rie de vagues oc√©aniques g√©antes provoqu√©es principalement par un s√©isme sous-marin. Contrairement aux vagues normales, l'√©nergie d'un tsunami traverse toute la colonne d'eau. Un retrait soudain de la mer est un signe d'alerte naturelle.</p>
                <p><strong>Conseils de S√©curit√©:</strong></p>
                <ul>
                    <li>Si vous ressentez un s√©isme fort pr√®s de la c√¥te, **√©vacuez imm√©diatement** vers l'int√©rieur des terres ou en hauteur (minimum 10 √©tages).</li>
                    <li>La menace peut durer plusieurs heures. **Ne jamais retourner sur la c√¥te** tant que les autorit√©s n'ont pas lev√© l'alerte.</li>
                </ul>
            `;
        } else if (element === 'meteo_severe') {
            content = `
                <h4>‚ö†Ô∏è M√©t√©o S√©v√®re : Types d'Alertes et R√©action</h4>
                <p><strong>Explication:</strong> Les alertes m√©t√©o s√©v√®res (orages violents, crues, vents extr√™mes, etc.) sont √©mises pour signaler un danger imminent ou en cours. La gravit√© est souvent codifi√©e (ex: Vert, Jaune, Orange, Rouge) pour indiquer la vigilance requise.</p>
                <p><strong>Conseils de R√©action (G√©n√©ral):</strong></p>
                <ul>
                    <li>**Suivre les instructions** des autorit√©s locales. S√©curiser les objets ext√©rieurs (mobilier de jardin, poubelles) qui pourraient √™tre emport√©s par le vent.</li>
                    <li>**Inondations:** Ne jamais tenter de traverser une zone inond√©e, ni √† pied, ni en voiture. Chercher refuge en hauteur.</li>
                </ul>
            `;
        } else if (element === 'uv_index') {
            content = `
                <h4>‚òÄÔ∏è L\'Indice UV (Ultraviolet) : Risque Solaire et Protection</h4>
                <p><strong>Explication:</strong> L'Indice UV mesure l'intensit√© du rayonnement ultraviolet solaire au niveau du sol. Il est class√© de **0 (risque faible)** √† **11+ (risque extr√™me)**. Il est crucial pour indiquer le risque de dommages cutan√©s et oculaires.</p>
                <p><strong>Conseils de Protection (Selon l'indice):</strong></p>
                <ul>
                    <li>**UV ‚â• 3:** Porter un chapeau et des lunettes de soleil. Chercher l'ombre.</li>
                    <li>**UV ‚â• 6:** Protection solaire (FPS 30+) obligatoire. V√™tements longs, exposition r√©duite.</li>
                    <li>**UV ‚â• 8:** Rester √† l'int√©rieur ou √† l'ombre totale aux heures de pointe. Protection maximale requise.</li>
                </ul>
            `;
        } else if (element === 'vent') {
            content = `
                <h4>üí® Le Vent : Vitesse, √âchelle de Beaufort et Impact</h4>
                <p><strong>Explication:</strong> Le vent est le mouvement d'air caus√© par les diff√©rences de pression atmosph√©rique. L'**√©chelle de Beaufort** (0 √† 12) est couramment utilis√©e pour d√©crire les effets du vent. Un vent est consid√©r√© comme fort (coup de vent) √† partir de 62 km/h (Force 8).</p>
                <p><strong>Conseils (Vent Fort):</strong></p>
                <ul>
                    <li>**En ville:** S'√©loigner des arbres et des structures fragiles. Se m√©fier des chutes d'objets (tuiles, panneaux).</li>
                    <li>**Conduite:** R√©duire la vitesse. Le vent peut d√©porter les v√©hicules, soyez prudent sur les ponts et les zones d√©gag√©es.</li>
                </ul>
            `;
        } else if (element === 'humidite') {
            content = `
                <h4>üíß L\'Humidit√© : Point de Ros√©e et Saturation</h4>
                <p><strong>Explication:</strong> L'humidit√© relative est le pourcentage de vapeur d'eau dans l'air. Le **point de ros√©e** est la temp√©rature √† laquelle l'air doit √™tre refroidi pour que l'eau se condense (brouillard, nuages, ros√©e). Un point de ros√©e √©lev√© (proche de la temp√©rature de l'air) signifie un risque accru de brume et une sensation d'√©touffement.</p>
                <p><strong>Impact:</strong></p>
                <ul>
                    <li>**Point de Ros√©e √©lev√© (20¬∞C+):** L'air est lourd et inconfortable, mauvaise √©vaporation de la transpiration.</li>
                    <li>**Point de Ros√©e bas (0¬∞C-):** L'air est sec, agr√©able mais peut causer des irritations (yeux, gorge).</li>
                </ul>
            `;
        }

        explanationBox.innerHTML = content;
        explanationBox.classList.add('visible');
    }

    // Enregistrement du service worker pour la PWA
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('{{ url_for("static", filename="service-worker.js") }}')
        .then(function(registration) {
            console.log('Service Worker enregistr√© avec succ√®s:', registration.scope);
        }).catch(function(error) {
            console.log('√âchec de l\'enregistrement du Service Worker:', error);
        });
    }
    </script>
</body>
</html>