<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>M√©t√©o D√©taill√©e</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <!-- Manifest PWA -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#6dd5fa">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- iOS PWA support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="M√©t√©o">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/icon-32.png') }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512.png') }}">

</head>
<body>
    <div class="container">
        <h1>üå§ M√©t√©o</h1>

        <!-- Formulaire -->
        <form method="POST">
            <input type="text" name="ville" placeholder="Entrez une ville" required>
            <button type="submit">Obtenir la m√©t√©o</button>
        </form>

        {% if meteo_actuelle %}
        <div class="result">

            <!-- Bloc m√©t√©o + photo -->
            <div class="meteo-block">
                <div class="meteo-info">
                    <h2>M√©t√©o actuelle pour {{ ville }}</h2>
                    <p class="meteo">{{ meteo_actuelle }}</p>
                    <ul>
                        {% for key, value in details.items() %}
                            <li><strong>{{ key }}:</strong> {{ value }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="city-photo">
                    <img src="{{ city_image_url }}" alt="Photo de {{ ville }}">
                </div>
            </div>

            <!-- Pr√©visions 3 jours avec d√©tails au clic -->
            <h2>Pr√©visions 3 jours</h2>
            <div class="previsions">
                {% for jour in prevision %}
                <div class="jour" onclick="toggleDetails({{ loop.index0 }})">
                    <h3>{{ jour.date }}</h3>
                    <p><strong>Condition:</strong> {{ jour.condition }}</p>
                    <div class="jour-details" id="details-{{ loop.index0 }}" style="display:none;">
                        <p><strong>Max:</strong> {{ jour.max_temp }}¬∞C</p>
                        <p><strong>Min:</strong> {{ jour.min_temp }}¬∞C</p>
                        <p><strong>Vent:</strong> {{ jour.vent }}</p>
                        <p><strong>Humidit√©:</strong> {{ jour.humidite }}</p>
                        <p><strong>UV:</strong> {{ jour.uv_index }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>

        </div>
        {% else %}
        <p>Entrez une ville pour voir la m√©t√©o d√©taill√©e.</p>
        {% endif %}

    </div>

    <!-- Scripts -->
    <script>
    // Afficher ou cacher les d√©tails des pr√©visions
    function toggleDetails(index) {
        const details = document.getElementById('details-' + index);
        details.style.display = (details.style.display === "none") ? "block" : "none";
    }

    // Enregistrement du service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('{{ url_for("static", filename="service-worker.js") }}')
        .then(function(registration) {
            console.log('Service Worker enregistr√© avec succ√®s:', registration.scope);
        }).catch(function(error) {
            console.log('√âchec de l\'enregistrement du Service Worker:', error);
        });
    }
    </script>
</body>
</html>
